<!DOCTYPE HTML>
<html lang="en">

<head>
    <title> SmartSim: Combining Machine Learning and HPC Workflows - Workflows Community Initiative</title>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="keywords" content="workflow, hpc, science, exascale, fair, reproducibility, distributed computing, artificial intelligence" />
<!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="SmartSim: Combining Machine Learning and HPC Workflows" />
<meta name="author" content="Matthew Ellis" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Machine learning (ML) algorithms have been successfully applied to a wide variety of commercial applications. However, adoption of ML in traditional high performance computing (HPC) applications has lagged other segments because of differences in software ecosystems and cluster management tools. Specifically, these applications are typically written in Fortran, C, and C++ and leverage OpenMP and/or MPI parallelization to extract peak performance on HPC platforms. On the other hand, ML toolkits are generally Python-based. Moreover, HPC systems use advanced workload managers to schedule and manage bare-metal jobs. The SmartSim library (https://craylabs.org) was developed by Cray and HPE to overcome these challenges and help users create novel HPC workflows that mesh modern data science with machine learning capabilities." />
<meta property="og:description" content="Machine learning (ML) algorithms have been successfully applied to a wide variety of commercial applications. However, adoption of ML in traditional high performance computing (HPC) applications has lagged other segments because of differences in software ecosystems and cluster management tools. Specifically, these applications are typically written in Fortran, C, and C++ and leverage OpenMP and/or MPI parallelization to extract peak performance on HPC platforms. On the other hand, ML toolkits are generally Python-based. Moreover, HPC systems use advanced workload managers to schedule and manage bare-metal jobs. The SmartSim library (https://craylabs.org) was developed by Cray and HPE to overcome these challenges and help users create novel HPC workflows that mesh modern data science with machine learning capabilities." />
<meta property="og:site_name" content="Workflows Community Initiative" />
<meta property="og:image" content="/images/stories/smartsim.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-04-02T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="/images/stories/smartsim.png" />
<meta property="twitter:title" content="SmartSim: Combining Machine Learning and HPC Workflows" />
<meta name="twitter:site" content="@WorkflowsCI" />
<meta name="twitter:creator" content="@Matthew Ellis" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Matthew Ellis"},"dateModified":"2023-04-02T00:00:00+00:00","datePublished":"2023-04-02T00:00:00+00:00","description":"Machine learning (ML) algorithms have been successfully applied to a wide variety of commercial applications. However, adoption of ML in traditional high performance computing (HPC) applications has lagged other segments because of differences in software ecosystems and cluster management tools. Specifically, these applications are typically written in Fortran, C, and C++ and leverage OpenMP and/or MPI parallelization to extract peak performance on HPC platforms. On the other hand, ML toolkits are generally Python-based. Moreover, HPC systems use advanced workload managers to schedule and manage bare-metal jobs. The SmartSim library (https://craylabs.org) was developed by Cray and HPE to overcome these challenges and help users create novel HPC workflows that mesh modern data science with machine learning capabilities.","headline":"SmartSim: Combining Machine Learning and HPC Workflows","image":"/images/stories/smartsim.png","mainEntityOfPage":{"@type":"WebPage","@id":"/stories/2023/04/02/smartsim/"},"url":"/stories/2023/04/02/smartsim/"}</script>
<!-- End Jekyll SEO tag -->


<!-- Prefetch DNS for faster page speed -->
<link rel="dns-prefetch" href="//fonts.googleapis.com" />
<link rel="dns-prefetch" href="//google-analytics.com" />
<link rel="dns-prefetch" href="//www.google-analytics.com" />
<link rel="dns-prefetch" href="//maxcdn.bootstrapcdn.com" />
<link rel="dns-prefetch" href="//ajax.googleapis.com" />
<link rel="dns-prefetch" href="//fonts.gstatic.com" />

<!-- icons -->
<link rel="icon" href="/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<link rel="apple-touch-icon" href="/favicon.ico" type="image/x-icon" />

<!-- stylesheets -->
<link href="https://fonts.googleapis.com/css?family=Work+Sans:100,200,300,400,700,800" rel="stylesheet">
<link rel="stylesheet" href="/assets/css/open-iconic-bootstrap.min.css" />
<link rel="stylesheet" href="/assets/css/animate.css" />
<link rel="stylesheet" href="/assets/css/owl.carousel.min.css">
<link rel="stylesheet" href="/assets/css/owl.theme.default.min.css">
<link rel="stylesheet" href="/assets/css/magnific-popup.css">
<link rel="stylesheet" href="/assets/css/aos.css">
<link rel="stylesheet" href="/assets/css/bootstrap-datepicker.css">
<link rel="stylesheet" href="/assets/css/jquery.timepicker.css">
<!-- <link rel="stylesheet" href="/assets/css/bootstrap.min.css" /> -->
<link rel="stylesheet" href="/assets/css/style.css" />
<link rel="stylesheet" href="/assets/css/fontawesome-all.min.css" />
<!-- <link rel="stylesheet" href="/assets/css/main.css" /> -->

<!-- scripts -->
<!-- <script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/jquery.countTo.js"></script>
<script src="/assets/js/bootstrap.min.js"></script> -->

<!-- <script type="text/javascript">
    $('.dropdown-toggle').dropdown();
</script> -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-271163E6PP"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-271163E6PP');
</script>

<!-- MapBox -->
<script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />

</head>

<body class="is-preload">
    <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
    <div class="container">
        <a class="navbar-brand" href="/"><img src="/images/wci-white-logo.png" style="width: 8em" alt="" id="logo" /></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav"
            aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
            <i class="fa-solid fa-bars"></i> Menu
        </button>

        <div class="collapse navbar-collapse" id="ftco-nav">
            <ul class="navbar-nav ml-auto">
                <!-- RESOURCES -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="dropdown01" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">Resources</a>
                    <div class="dropdown-menu" aria-labelledby="dropdown01">
                        <a class="dropdown-item" href="/systems">Workflow Systems</a>
                        <a class="dropdown-item" href="/registries">Workflow Registries</a>
                        <a class="dropdown-item" href="/education">Education and Training</a>
                        <a class="dropdown-item" href="/reports">Reports</a>
                    </div>
                </li>
                <!-- RESEARCH -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="dropdown02" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">Research</a>
                    <div class="dropdown-menu" aria-labelledby="dropdown02">
                        <a class="dropdown-item" href="/groups">Working Groups</a>
                        <a class="dropdown-item" href="/frameworks">Research Frameworks</a>
                    </div>
                </li>
                <!-- EVENTS -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="dropdown03" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">Events</a>
                    <div class="dropdown-menu" aria-labelledby="dropdown03">
                        <a class="dropdown-item" href="/summits">Workflows Community Summits</a>
                        <a class="dropdown-item" href="/bof">Birds of a Feather (BoF)</a>
                        <a class="dropdown-item" href="/events">Workflows-Related Events</a>
                    </div>
                </li>
                <li class="nav-item"><a href="/members" class="nav-link">Members</a></li>
                <li class="nav-item"><a href="/jobs" class="nav-link">Jobs</a></li>
                <li class="nav-item"><a href="/about" class="nav-link">About</a></li>
                <li class="nav-item cta"><a href="/contact" class="nav-link"><span>Get involved!</span></a></li>
            </ul>
        </div>
    </div>
</nav>


    <div class="hero-wrap js-fullheight" style="max-height: 300px">
        <div class="overlay" style="max-height: 300px"></div>
        <div id="particles-js" style="max-height: 300px"></div>
        <div class="container" style="max-height: 300px">
            <div class="row no-gutters slider-text justify-content-center" data-scrollax-parent="true">
                <div class="col-md-6 ftco-animate text-center" data-scrollax=" properties: { translateY: '70%' }">
                    <h1 class="" data-scrollax="properties: { translateY: '90%', opacity: 1.6 }"
                        style="font-size: 2em; padding-top: 5.5em; font-weight: bold;">
                        SmartSim: Combining Machine Learning and HPC Workflows
                    </h1>
                </div>
            </div>
        </div>
    </div>

    <section class="ftco-section">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-lg-9 ftco-animate">
                    <div class="row justify-content-center mb-2 pb-2">
    <div class="col-md-8 text-center heading-section ftco-animate mb-5">
        <span class="subheading">Apr 02, 2023</span><br />
        <div class="row mt-4">
            
            <div class="col-md-6" style="margin: auto">
                <img src="/images/stories/ellis.jpeg" alt="Matthew Ellis"
                    style="width: 3.5em; height: 3.5em; border-radius: 50%; margin-right: 1em;" /><br />
                <div><span class="subheading" style="color: #999">Matthew Ellis</span></div>
                <div style="color: #bbb">HPE</div>
            </div>
            
            <div class="col-md-6" style="margin: auto">
                <img src="/images/stories/scherer.jpeg" alt="Bill Scherer"
                    style="width: 3.5em; height: 3.5em; border-radius: 50%; margin-right: 1em;" /><br />
                <div><span class="subheading" style="color: #999">Bill Scherer</span></div>
                <div style="color: #bbb">HPE</div>
            </div>
            
            <div class="col-md-6" style="margin: auto">
                <img src="/images/stories/shao.jpeg" alt="Andrew Shao"
                    style="width: 3.5em; height: 3.5em; border-radius: 50%; margin-right: 1em;" /><br />
                <div><span class="subheading" style="color: #999">Andrew Shao</span></div>
                <div style="color: #bbb">HPE</div>
            </div>
            
        </div>
    </div>
</div>

<div class="col-md-12 ftco-animate mb-5">
    <p>Machine learning (ML) algorithms have been successfully applied to a wide variety of commercial applications.  However, adoption of ML in traditional high performance computing (HPC) applications has lagged other segments because of differences in software ecosystems and cluster management tools.  Specifically, these applications are typically written in Fortran, C, and C++ and leverage OpenMP and/or MPI parallelization to extract peak performance on HPC platforms. On the other hand, ML toolkits are generally Python-based. Moreover, HPC systems use advanced workload managers to schedule and manage bare-metal jobs.  The SmartSim library (<a href="https://craylabs.org">https://craylabs.org</a>) was developed by Cray and HPE to overcome these challenges and help users create novel HPC workflows that mesh modern data science with machine learning capabilities.</p>

<h3 id="smartsim-overview">SmartSim Overview</h3>

<p>SmartSim is an open-source software package developed by Hewlett Packard Enterprise (HPE) that helps users combine traditional engineering, scientific, and high-performance computing applications with machine learning tools and visualization packages.  Internally, SmartSim consists of two libraries: an infrastructure library and a client library. The infrastructure library’s API enables users to configure scientific applications and to define and launch experiments (potentially including ensembles of simulations).  As part of the machine learning infrastructure, SmartSim launches an in-memory database accessible across all applications in the workflow.  Machine learning models can be executed inside the database or data can be streamed out of it for visualization and training.  Machine learning infrastructure can be launched on CPU, GPU, or multi-GPU compute nodes, and the SmartSim library has features to help users achieve maximum workload throughput with all of these systems.  SmartSim supports launching user-described workflows on several HPC workload managers including Slurm, PBS, LSF, and Cobalt.  SmartSim also allows users to launch workflows locally on MacOS or Linux systems.</p>

<p>The SmartSim client library, for its part, provides interfaces that can be embedded into any Fortran, C, C++, or Python application.  With these clients, applications can transfer data to and from the in-memory database and they can execute ML tasks (such as inference) on this data.  Also, because the database is accessible by all component applications in the workflow, data can be streamed into and out of the database for online analysis and ML model training.  Further, the client library offers optimized aggregation methods that retrieve data from the database for tasks such as online visualization and online training.  The SmartSim client library needs only a TCP/IP connection to communicate with the database so it is highly portable.</p>

<p><img src="/images/stories/smartsim.png" alt="SmartSim" width="100%" style="padding: 1em" /><br /></p>
<p class="caption">Sample experiment showing a workflow with machine learning infrastructure launched by SmartSim and connected to online analysis and visualization via the in-memory database.</p>

<h3 id="smartsim-usage-example-embedding-ml-to-improve-the-accuracy-of-ocean-modeling">SmartSim Usage Example: Embedding ML to Improve the Accuracy of Ocean Modeling</h3>

<p>Within the oceanographic community, the behavior of the water in oceans is simulated via ocean general circulation models (OGCMs). OGCMs use the Navier-Stokes partial differential equations (PDEs) to represent the laws of conservation of mass, momentum, and energy. Parameterizations added to these PDEs account for physical processes that occur at scales smaller than the model grid, but their unconstrained use can violate the conservation laws. Modern ocean modeling theory considers eddy energy (EKE) to be a critical variable in these parameterizations. The current state of the art numerically solves a PDE that describes EKE; however, the estimation or omission of a number of terms leads to significant errors. To improve the quality of OGCMs, collaborators from HPE, the Canadian Centre for Climate Modelling and Analysis, and the National Center for Atmospheric Research (NCAR) used a data-driven approach with machine learning to replace the EKE PDE. SmartSim is the key technology that allowed this ML model to be meshed with existing OGCMs. As a result of these efforts, we were able to improve the simulation accuracy without impeding performance in large-scale climate simulations.</p>

<p>In this work, we evaluated the results of our ML approach to the numerical approach using the Modular Ocean Model version 6 (MOM6). We compared the EKE estimated by each approach to the baseline EKE calculated by a third ‘eddy-resolving’ (ER) simulation with a spatial resolution of about 10 kilometers. This resolution is sufficient to resolve mesoscale eddies (turbulence) in the equator and mid-latitudes, but it is computationally expensive.  The other two configurations coarsen the spatial resolution to 25 kilometers, which places them into an ‘eddy-permitting’ regime where modeling the impact of eddies on the rest of the simulation requires turbulence parameterization. The coarser configurations differ only in their eddy parameterization models: one uses the Mesoscale Eddy Kinetic Energy (MEKE), which represents the current state-of-the-art.  The other uses “SmartSim-EKE”, which is based on a neural network trained to infer the eddy kinetic energy.</p>

<p>In our demonstration, we used SmartSim’s ensemble capabilities to run 12 parallel SmartSim-EKE simulations thereby demonstrating the scalability and performance of SmartSim. In so doing we were able to evaluate the accuracy of EKE parameterizations, and estimate overall computational cost at scale. We computed each ensemble member for 10 simulated years on an aggregate total combining 10,920 Intel Skylake and Cascadelake processors cores along with 16 Nvidia P100 GPUs dedicated to the shared in-memory database.  Figure 2 summarizes the MOM6 ensemble workflow and the translation of SmartSim workflow descriptions to launched jobs on the hardware cluster.</p>

<p><img src="/images/stories/smartsim2.png" alt="SmartSim" width="60%" style="padding: 1em" /><br /></p>
<p class="caption">Summary of MOM6 workflow developed with SmartSim.</p>

<p>We compare SmartSim-EKE and MEKE to the “true” EKE calculated from ER in the images below.  As shown in Figures 3 and 4 below, SmartSim-EKE tends to overestimate the extent of the equatorial (0 latitude) EKE, but otherwise provides a much more accurate predictions of large-scale trends compared to the MEKE state-of-the-art predictions.  Importantly, these gains in accuracy from the SmartSim-EKE ML model did not incur significant computational penalties relative to the state-of-the-art.  Specifically, we observed only a 1.5% slowdown in the simulation – negligible on modern systems with heterogenous compute nodes and higher GPU counts. These results show that machine learning infused into traditional HPC workloads can provide significant improvements in accuracy and/or performance.  Moreover, SmartSim enabled these ML-driven gains without extensive changes to the HPC application source code or requiring maintenance of a one-of-a-kind ML infrastructure.  More detailed information on the accuracy and performance of this SmartSim use case can be found in the Journal of Computational Science (<a href="https://doi.org/10.1016/j.jocs.2022.101707">https://doi.org/10.1016/j.jocs.2022.101707</a>).</p>

<p><img src="/images/stories/smartsim3.png" alt="SmartSim" width="100%" style="padding: 1em" /><br /></p>
<p class="caption">Eddy kinetic energy (EKE), averaged over the last year of each simulation, calculated from the most-accurate eddy-resolving (ER) simulation (a), inferred using SmartSim-EKE and averaged over all 12 ensemble members (b), and the current state-of-the-art MEKE parameterization (c).</p>

<p><img src="/images/stories/smartsim4.png" alt="SmartSim" width="60%" style="padding: 1em" /><br /></p>
<p class="caption">Zonally averaged EKE (on a log10 scale) as a function of latitude from the ER, SmartSim-EKE, and MEKE. Note that within 20 degrees of the equator MEKE computes a near-zero value for EKE.</p>

<p>To stay up-to-date on new SmartSim features and release, please favorite (star) the SmartSim GitHub repository: <a href="https://github.com/CrayLabs/SmartSim">https://github.com/CrayLabs/SmartSim</a>.</p>

</div>
                </div>
                <div class="col-md-6 col-lg-3 ftco-animate">
                    <a class="twitter-timeline" data-lang="en" data-height="1500" data-width="100%" data-theme="light"
                        data-chrome="nofooter" href="https://twitter.com/WorkflowsCI">Tweets by WorkflowsCI</a>
                    <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
                </div>
            </div>
        </div>
    </section>

    <footer class="ftco-footer ftco-bg-dark ftco-section">
    <div class="container">
        <div class="row mb-5">
            <div class="col-md">
                <div class="ftco-footer-widget mb-4">
                    <h2 class="ftco-heading-2">Workflows Community Initiative</h2>
                    <p>Our goal is to bring the workflows community together (users, developers, researchers, and
                        facilities) to provide <strong>community resources and capabilities</strong> to enable
                        scientists
                        and workflow systems developers to discover software products, related efforts, events,
                        technical
                        reports, etc. and engage in community-wide efforts to tackle workflows grand challenges.</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="ftco-footer-widget mb-4">
                    <ul class="ftco-footer-social list-unstyled float-md-left float-lft">
                        <li>
                            <a href="https://www.youtube.com/channel/UCqCnXqWqKe9vF6cqKOj1CYw" target="_blank"
                                class="fa-stack fa-2x" style="font-size: 1.5em">
                                <i class="fa fa-circle fa-stack-2x" style="color: #aaa"></i>
                                <i class="fab fa-youtube fa-stack-1x"></i>
                            </a>
                        </li>
                        <li>
                            <a href="mailto:contact@workflows.community" class="fa-stack fa-2x"
                                style="font-size: 1.5em">
                                <i class="fa fa-circle fa-stack-2x" style="color: #aaa"></i>
                                <i class="fa fa-envelope fa-stack-1x"></i>
                            </a>
                        </li>
                        <li>
                            <a href="http://twitter.com/WorkflowsCI" target="_blank" class="fa-stack fa-2x"
                                style="font-size: 1.5em">
                                <i class="fa fa-circle fa-stack-2x" style="color: #aaa"></i>
                                <i class="fab fa-twitter fa-stack-1x"></i>
                            </a>
                        </li>
                        <li>
                            <a href="https://join.slack.com/t/workflowscommunity/shared_invite/zt-1s8u3ocgm-gNdsgRJgy6O2GNSFUf9eDQ"
                                target="_blank" class="fa-stack fa-2x" style="font-size: 1.5em">
                                <i class="fa fa-circle fa-stack-2x" style="color: #aaa"></i>
                                <i class="fab fa-slack fa-stack-1x"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 text-center">

                <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                    &copy;2023 Workflows.Community Initiative
                    <br />
                    <span style="color: #888">This template is made with
                        <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank"
                            style="color: #888">Colorlib</a>
                    </span>
                    <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                </p>
            </div>
        </div>
    </div>
</footer>

<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/jquery-migrate-3.0.1.min.js"></script>
<script src="/assets/js/popper.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/jquery.easing.1.3.js"></script>
<script src="/assets/js/jquery.waypoints.min.js"></script>
<script src="/assets/js/jquery.stellar.min.js"></script>
<script src="/assets/js/owl.carousel.min.js"></script>
<script src="/assets/js/jquery.magnific-popup.min.js"></script>
<script src="/assets/js/aos.js"></script>
<script src="/assets/js/jquery.animateNumber.min.js"></script>
<script src="/assets/js/bootstrap-datepicker.js"></script>
<!-- <script src="/assets/js/jquery.timepicker.min.js"></script> -->
<script src="/assets/js/particles.min.js"></script>
<script src="/assets/js/particle.js"></script>
<script src="/assets/js/scrollax.min.js"></script>
<!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script> -->
<!-- <script src="/assets/js/google-map.js"></script> -->
<script src="/assets/js/main.js"></script>


</body>

</html>